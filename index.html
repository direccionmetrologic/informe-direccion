<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<title>Informe de Direcci√≥n ‚Äî Laboratorio de Calibraci√≥n</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,500;9..40,700&family=Playfair+Display:wght@600;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0b0f19;--bg2:#111827;--bg3:#1a2234;--card:#161e2e;
  --border:#263045;--border2:#334155;
  --txt:#e2e8f0;--txt2:#94a3b8;--txt3:#64748b;
  --accent:#60a5fa;--accent2:#3b82f6;--green:#34d399;--green2:#059669;
  --amber:#fbbf24;--amber2:#d97706;--red:#f87171;--red2:#dc2626;
  --purple:#a78bfa;--purple2:#7c3aed;
  --orange:#fb923c;--orange2:#ea580c;
  --font:'DM Sans',system-ui,-apple-system,sans-serif;
  --display:'Playfair Display',Georgia,serif;
  --rad:14px;--rad-sm:10px;
}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{font-family:var(--font);background:var(--bg);color:var(--txt);line-height:1.6;min-height:100vh;
  background-image:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(59,130,246,.08),transparent),
    radial-gradient(ellipse 60% 40% at 100% 0%,rgba(124,58,237,.05),transparent)}

/* LOGIN */
.login-overlay{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;align-items:center;justify-content:center;transition:opacity .5s,visibility .5s}
.login-overlay.hidden{opacity:0;visibility:hidden;pointer-events:none}
.login-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:48px 44px;width:420px;max-width:92vw;text-align:center;box-shadow:0 25px 80px rgba(0,0,0,.5);position:relative;overflow:hidden}
.login-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#60a5fa,#a78bfa,#60a5fa);background-size:200% 100%;animation:shimmer 3s ease infinite}
@keyframes shimmer{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.login-logo{width:80px;height:80px;border-radius:20px;background:linear-gradient(135deg,#1e293b,#263045);display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:2.5rem;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.login-title{font-family:var(--display);font-size:1.6rem;font-weight:800;color:#fff;margin-bottom:6px}
.login-subtitle{color:var(--txt3);font-size:.88rem;margin-bottom:32px}
.login-input-wrap{position:relative;margin-bottom:20px}
.login-input{width:100%;padding:14px 48px 14px 18px;background:var(--bg);border:1px solid var(--border2);border-radius:12px;color:var(--txt);font-size:1rem;font-family:var(--font);outline:none;transition:border-color .2s,box-shadow .2s}
.login-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(96,165,250,.15)}
.login-input::placeholder{color:#475569}
.login-eye{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--txt3);cursor:pointer;font-size:1.1rem;padding:4px}
.login-btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#3b82f6,#7c3aed);color:#fff;font-size:1rem;font-weight:700;font-family:var(--font);cursor:pointer;transition:transform .15s,box-shadow .2s;letter-spacing:.02em}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 8px 30px rgba(59,130,246,.3)}
.login-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
.login-error{color:var(--red);font-size:.82rem;margin-top:12px;min-height:20px}
.login-footer{margin-top:28px;padding-top:20px;border-top:1px solid #1e293b;color:#475569;font-size:.75rem}

/* REPORT */
#report{display:none;opacity:0;transition:opacity .6s}
#report.visible{display:block;opacity:1}
.container{max-width:1320px;margin:0 auto;padding:0 24px}
@media(max-width:768px){.container{padding:0 14px}}
.header{background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);border-bottom:1px solid var(--border);padding:40px 0 32px;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:-60%;right:-10%;width:500px;height:500px;background:radial-gradient(circle,rgba(96,165,250,.08),transparent 70%);pointer-events:none}
.header-inner{display:flex;justify-content:space-between;align-items:flex-end;flex-wrap:wrap;gap:16px}
.header h1{font-family:var(--display);font-size:clamp(1.6rem,4vw,2.5rem);font-weight:800;letter-spacing:-.02em;color:#fff;line-height:1.15}
.header h1 span{background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-meta{text-align:right}
.header-meta .periodo{font-size:1.05rem;font-weight:700;color:var(--accent);background:rgba(96,165,250,.1);padding:6px 16px;border-radius:999px;border:1px solid rgba(96,165,250,.2);display:inline-block}
.header-meta .fecha{font-size:.82rem;color:var(--txt3);margin-top:8px}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin:28px 0 36px}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:var(--rad);padding:20px 18px;position:relative;overflow:hidden;transition:transform .2s,border-color .3s}
.kpi-card:hover{transform:translateY(-3px);border-color:var(--border2)}
.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:var(--rad) var(--rad) 0 0}
.kpi-card.cal::before{background:linear-gradient(90deg,var(--green),var(--green2))}
.kpi-card.tec::before{background:linear-gradient(90deg,var(--accent),var(--accent2))}
.kpi-card.serv::before{background:linear-gradient(90deg,var(--amber),var(--amber2))}
.kpi-card.nov::before{background:linear-gradient(90deg,var(--orange),var(--orange2))}
.kpi-card.sup::before{background:linear-gradient(90deg,var(--purple),var(--purple2))}
.kpi-label{font-size:.78rem;font-weight:500;color:var(--txt3);text-transform:uppercase;letter-spacing:.06em}
.kpi-value{font-family:var(--display);font-size:2.2rem;font-weight:800;line-height:1.1;margin:6px 0 2px}
.kpi-card.cal .kpi-value{color:var(--green)}
.kpi-card.tec .kpi-value{color:var(--accent)}
.kpi-card.serv .kpi-value{color:var(--amber)}
.kpi-card.nov .kpi-value{color:var(--orange)}
.kpi-card.sup .kpi-value{color:var(--purple)}
.kpi-sub{font-size:.78rem;color:var(--txt3)}
.section{margin-bottom:36px}
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid var(--border)}
.section-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
.section-icon.green{background:rgba(52,211,153,.12);color:var(--green)}
.section-icon.amber{background:rgba(251,191,36,.12);color:var(--amber)}
.section-icon.orange{background:rgba(251,146,60,.12);color:var(--orange)}
.section-icon.purple{background:rgba(167,139,250,.12);color:var(--purple)}
.section-title{font-family:var(--display);font-size:1.35rem;font-weight:600;color:#fff}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--rad);padding:24px}
.card-title{font-size:.85rem;font-weight:700;color:var(--txt2);text-transform:uppercase;letter-spacing:.04em;margin-bottom:16px}
.row{display:grid;gap:18px}
.row.c2{grid-template-columns:repeat(2,1fr)}
.row.c3{grid-template-columns:repeat(3,1fr)}
@media(max-width:900px){.row.c2,.row.c3{grid-template-columns:1fr}}
.chart-wrap{position:relative;width:100%;max-height:340px}
.chart-wrap canvas{width:100%!important;max-height:340px}
.rank-list{list-style:none}
.rank-item{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:var(--rad-sm);transition:background .15s}
.rank-item:hover{background:rgba(255,255,255,.03)}
.rank-pos{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;flex-shrink:0}
.rank-pos.gold{background:rgba(251,191,36,.15);color:var(--amber)}
.rank-pos.silver{background:rgba(148,163,184,.12);color:var(--txt2)}
.rank-pos.bronze{background:rgba(251,146,60,.12);color:var(--orange)}
.rank-pos.normal{background:var(--bg3);color:var(--txt3)}
.rank-name{flex:1;font-size:.9rem;font-weight:500;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rank-bar-wrap{flex:0 0 120px;height:6px;background:var(--bg);border-radius:99px;overflow:hidden}
.rank-bar{height:100%;border-radius:99px;transition:width .6s ease}
.rank-val{font-size:.9rem;font-weight:700;min-width:40px;text-align:right}
.tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;font-size:.82rem}
thead th{background:var(--bg3);color:var(--txt2);font-weight:600;padding:10px 12px;text-align:left;white-space:nowrap;border-bottom:2px solid var(--border2);font-size:.75rem;text-transform:uppercase;letter-spacing:.04em}
tbody td{padding:9px 12px;border-bottom:1px solid var(--border);color:var(--txt);vertical-align:middle}
tbody tr:hover{background:rgba(255,255,255,.02)}
.badge{display:inline-block;padding:2px 10px;border-radius:99px;font-size:.72rem;font-weight:600;white-space:nowrap}
.badge.green{background:rgba(52,211,153,.12);color:var(--green)}
.badge.amber{background:rgba(251,191,36,.12);color:var(--amber)}
.badge.red{background:rgba(248,113,113,.12);color:var(--red)}
.badge.blue{background:rgba(96,165,250,.12);color:var(--accent)}
.badge.purple{background:rgba(167,139,250,.12);color:var(--purple)}
.badge.orange{background:rgba(251,146,60,.12);color:var(--orange)}
.footer{text-align:center;padding:32px 0;margin-top:48px;border-top:1px solid var(--border);color:var(--txt3);font-size:.78rem}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.anim{animation:fadeUp .5s ease both}
.anim-d1{animation-delay:.1s}.anim-d2{animation-delay:.2s}.anim-d3{animation-delay:.3s}.anim-d4{animation-delay:.4s}
@media print{.login-overlay{display:none!important}body{background:#fff;color:#1a1a1a;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .header{background:#1e293b!important}.kpi-card,.card{border:1px solid #ddd;break-inside:avoid}#report{display:block!important;opacity:1!important}}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-card">
    <div class="login-logo">‚öóÔ∏è</div>
    <div class="login-title">Informe de Direcci√≥n</div>
    <div class="login-subtitle">Laboratorio de Calibraci√≥n ¬∑ Metrologic Solutions</div>
    <div class="login-input-wrap">
      <input type="password" class="login-input" id="pwdInput" placeholder="Ingrese la contrase√±a" autocomplete="off">
      <button class="login-eye" id="eyeBtn" type="button">üëÅ</button>
    </div>
    <button class="login-btn" id="loginBtn">Acceder al informe</button>
    <div class="login-error" id="loginError"></div>
    <div class="login-footer"><span>üîí</span> Cifrado AES-256-GCM ¬∑ Solo personal autorizado</div>
  </div>
</div>

<!-- REPORT -->
<div id="report">
<header class="header"><div class="container header-inner">
  <div><h1>Informe de <span>Direcci√≥n</span></h1><p style="color:var(--txt3);margin-top:6px;font-size:.95rem">Laboratorio de Calibraci√≥n ¬∑ Metrologic Solutions</p></div>
  <div class="header-meta"><div class="periodo" id="periodo"></div><div class="fecha" id="fecha-gen"></div></div>
</div></header>
<main class="container">
  <div class="kpi-grid" id="kpi-grid"></div>
  <section class="section anim anim-d1"><div class="section-header"><div class="section-icon green">üìä</div><h2 class="section-title">Calibraciones</h2></div>
    <div class="row c2"><div class="card"><div class="card-title">Calibraciones por mes</div><div class="chart-wrap"><canvas id="chart-cal-mes"></canvas></div></div>
    <div class="card"><div class="card-title">Top T√©cnicos</div><ul class="rank-list" id="rank-tecnicos"></ul></div></div></section>
  <section class="section anim anim-d2"><div class="section-header"><div class="section-icon amber">üîß</div><h2 class="section-title">Servicios Pendientes</h2></div>
    <div class="row c2"><div class="card"><div class="card-title">Distribuci√≥n por estado</div><div class="chart-wrap" style="max-height:280px"><canvas id="chart-serv"></canvas></div></div>
    <div class="card"><div class="card-title">Detalle de estados</div><ul class="rank-list" id="rank-servicios"></ul></div></div></section>
  <section class="section anim anim-d3"><div class="section-header"><div class="section-icon orange">üë•</div><h2 class="section-title">Novedades de Personal</h2></div>
    <div class="row c2"><div class="card"><div class="card-title">Horas por tipo de novedad</div><div class="chart-wrap"><canvas id="chart-nov"></canvas></div></div>
    <div class="card"><div class="card-title">Detalle de novedades</div><div class="tbl-wrap"><table id="tbl-novedades"><thead><tr><th>Fecha</th><th>T√©cnico</th><th>Tipo</th><th>Horas</th></tr></thead><tbody></tbody></table></div></div></div></section>
  <section class="section anim anim-d4"><div class="section-header"><div class="section-icon purple">üìÑ</div><h2 class="section-title">Suplementos de Calibraci√≥n</h2></div>
    <div class="row c3"><div class="card"><div class="card-title">Por tipo de error</div><div class="chart-wrap" style="max-height:260px"><canvas id="chart-sup-tipo"></canvas></div></div>
    <div class="card"><div class="card-title">Por fuente de error</div><div class="chart-wrap" style="max-height:260px"><canvas id="chart-sup-fuente"></canvas></div></div>
    <div class="card"><div class="card-title">Top Clientes</div><ul class="rank-list" id="rank-clientes-sup"></ul></div></div>
    <div class="row" style="margin-top:18px"><div class="card"><div class="card-title">Detalle de suplementos</div><div class="tbl-wrap"><table id="tbl-suplementos"><thead><tr><th>Fecha</th><th>Cliente</th><th>N√∫meros</th><th>T√©cnico</th><th>Tipo Error</th><th>Fuente</th><th>Estado</th></tr></thead><tbody></tbody></table></div></div></div></section>
</main>
<footer class="footer"><p>Generado autom√°ticamente ¬∑ Dashboard Laboratorio de Calibraci√≥n ¬∑ Metrologic Solutions</p></footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ENCRYPTED DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ENC = {"salt": "AOyjE1B7OY2jqAdOuBCIYQ==", "iv": "ZR7W3+deh7a3cJGx", "ciphertext": "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"};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AES-256-GCM DECRYPT (Web Crypto API) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function decryptData(password) {
  const salt = Uint8Array.from(atob(ENC.salt), c => c.charCodeAt(0));
  const iv = Uint8Array.from(atob(ENC.iv), c => c.charCodeAt(0));
  const ciphertext = Uint8Array.from(atob(ENC.ciphertext), c => c.charCodeAt(0));

  const enc = new TextEncoder();
  const keyMaterial = await crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]);

  const key = await crypto.subtle.deriveKey(
    { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    false,
    ["decrypt"]
  );

  const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, key, ciphertext);
  return JSON.parse(new TextDecoder().decode(decrypted));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const $=s=>document.querySelector(s);
const eyeBtn=$('#eyeBtn'),pwdInput=$('#pwdInput'),loginBtn=$('#loginBtn'),errEl=$('#loginError');

eyeBtn.addEventListener('click',()=>{
  if(pwdInput.type==='password'){pwdInput.type='text';eyeBtn.textContent='üîí'}
  else{pwdInput.type='password';eyeBtn.textContent='üëÅ'}
});
pwdInput.addEventListener('keydown',e=>{if(e.key==='Enter')authenticate()});
loginBtn.addEventListener('click',authenticate);

async function authenticate(){
  const pwd=pwdInput.value;
  if(!pwd){errEl.textContent='Ingrese la contrase√±a';return}
  loginBtn.disabled=true;loginBtn.textContent='Descifrando...';errEl.textContent='';
  try{
    const D=await decryptData(pwd);
    $('#loginOverlay').classList.add('hidden');
    const r=$('#report');r.style.display='block';
    setTimeout(()=>r.classList.add('visible'),50);
    renderReport(D);
  }catch(e){
    errEl.textContent='‚ùå Contrase√±a incorrecta';
    loginBtn.disabled=false;loginBtn.textContent='Acceder al informe';
    pwdInput.select();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER REPORT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const palette={
  green:['#34d399','#059669','#047857','#065f46','#064e3b'],
  blue:['#60a5fa','#3b82f6','#2563eb','#1d4ed8','#1e40af'],
  amber:['#fbbf24','#f59e0b','#d97706','#b45309','#92400e'],
  orange:['#fb923c','#f97316','#ea580c','#c2410c','#9a3412'],
  purple:['#a78bfa','#8b5cf6','#7c3aed','#6d28d9','#5b21b6'],
  mixed:['#34d399','#60a5fa','#fbbf24','#fb923c','#a78bfa','#f87171','#38bdf8','#4ade80','#facc15','#c084fc']
};
const rankClass=i=>i===0?'gold':i===1?'silver':i===2?'bronze':'normal';
function badgeFor(t){t=(t||'').toLowerCase();if(t.includes('cliente'))return'blue';if(t.includes('laboratorio'))return'red';if(t.includes('pendiente'))return'amber';if(t.includes('enviado')||t.includes('complet'))return'green';if(t.includes('proceso'))return'orange';return'purple'}

function renderReport(D){
  Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='#263045';Chart.defaults.font.family="'DM Sans',system-ui,sans-serif";
  $('#periodo').textContent='üìÜ  '+(D.meta.periodo||D.meta.anio);
  $('#fecha-gen').textContent='Generado: '+D.meta.generado;

  const kpis=[
    {cls:'cal',label:'Calibraciones',value:D.kpis.calibraciones,sub:D.kpis.tecnicos+' t√©cnicos'},
    {cls:'tec',label:'T√©cnicos Activos',value:D.kpis.tecnicos,sub:D.kpis.calibraciones>0&&D.kpis.tecnicos>0?'~'+(D.kpis.calibraciones/D.kpis.tecnicos).toFixed(0)+' cal/t√©c':''},
    {cls:'serv',label:'Serv. Pendientes',value:D.kpis.servicios,sub:D.servicios.total_registros+' registros'},
    {cls:'nov',label:'Novedades',value:D.kpis.novedades,sub:D.kpis.horas_novedades+'h totales'},
    {cls:'sup',label:'Suplementos',value:D.kpis.suplementos,sub:D.suplementos.total_cantidad+' certificados'}
  ];
  const kg=$('#kpi-grid');
  kpis.forEach((k,i)=>{kg.innerHTML+=`<div class="kpi-card ${k.cls} anim" style="animation-delay:${i*.07+.1}s"><div class="kpi-label">${k.label}</div><div class="kpi-value">${k.value.toLocaleString('es-CO')}</div><div class="kpi-sub">${k.sub}</div></div>`});

  const cm=D.calibraciones.por_mes;
  if(cm.length){new Chart($('#chart-cal-mes'),{type:'bar',data:{labels:cm.map(m=>m.mes),datasets:[{data:cm.map(m=>m.cantidad),backgroundColor:cm.map((_,i)=>palette.green[i%5]+'cc'),borderColor:cm.map((_,i)=>palette.green[i%5]),borderWidth:1,borderRadius:6,maxBarThickness:48}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'#1a2234'}},x:{grid:{display:false}}}}})}

  const tecs=D.calibraciones.por_tecnico.slice(0,10),mxT=tecs.length?tecs[0].cantidad:1,rt=$('#rank-tecnicos');
  tecs.forEach((t,i)=>{const p=(t.cantidad/mxT*100).toFixed(0);rt.innerHTML+=`<li class="rank-item"><span class="rank-pos ${rankClass(i)}">${i+1}</span><span class="rank-name">${t.nombre}</span><span class="rank-bar-wrap"><span class="rank-bar" style="width:${p}%;background:${palette.green[Math.min(i,4)]}"></span></span><span class="rank-val" style="color:${palette.green[0]}">${t.cantidad}</span></li>`});

  const sd=D.servicios.por_estado;
  if(sd.length){new Chart($('#chart-serv'),{type:'doughnut',data:{labels:sd.map(s=>s.estado),datasets:[{data:sd.map(s=>s.cantidad),backgroundColor:sd.map((_,i)=>palette.mixed[i%palette.mixed.length]+'dd'),borderColor:'#161e2e',borderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,cutout:'55%',plugins:{legend:{position:'bottom',labels:{padding:14,usePointStyle:true,pointStyleWidth:10,font:{size:11}}}}}})}

  const mxS=sd.length?Math.max(...sd.map(s=>s.cantidad)):1,rs=$('#rank-servicios');
  sd.forEach((s,i)=>{const p=(s.cantidad/mxS*100).toFixed(0);rs.innerHTML+=`<li class="rank-item"><span class="rank-pos ${rankClass(i)}">${i+1}</span><span class="rank-name">${s.estado}</span><span class="rank-bar-wrap"><span class="rank-bar" style="width:${p}%;background:${palette.amber[Math.min(i,4)]}"></span></span><span class="rank-val" style="color:${palette.amber[0]}">${s.cantidad}</span></li>`});

  const nd=D.novedades.por_tipo;
  if(nd.length){new Chart($('#chart-nov'),{type:'bar',data:{labels:nd.map(n=>n.tipo),datasets:[{label:'Horas',data:nd.map(n=>n.horas),backgroundColor:palette.orange[0]+'bb',borderColor:palette.orange[0],borderWidth:1,borderRadius:6,yAxisID:'y'},{label:'Cantidad',data:nd.map(n=>n.cantidad),backgroundColor:palette.blue[0]+'88',borderColor:palette.blue[0],borderWidth:1,borderRadius:6,yAxisID:'y1'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{usePointStyle:true,pointStyleWidth:10,font:{size:11}}}},scales:{y:{beginAtZero:true,position:'left',grid:{color:'#1a2234'},title:{display:true,text:'Horas',font:{size:11}}},y1:{beginAtZero:true,position:'right',grid:{drawOnChartArea:false},title:{display:true,text:'Cantidad',font:{size:11}}},x:{grid:{display:false},ticks:{maxRotation:45,font:{size:10}}}}}})}

  const tn=$('#tbl-novedades tbody');
  D.novedades.detalle.forEach(n=>{tn.innerHTML+=`<tr><td>${n.fecha}</td><td>${n.tecnico}</td><td><span class="badge orange">${n.tipo}</span></td><td style="font-weight:600">${n.horas}h</td></tr>`});
  if(!D.novedades.detalle.length)tn.innerHTML='<tr><td colspan="4" style="text-align:center;color:var(--txt3)">Sin novedades</td></tr>';

  const st=D.suplementos.por_tipo_error;
  if(st.length){new Chart($('#chart-sup-tipo'),{type:'doughnut',data:{labels:st.map(s=>s.tipo),datasets:[{data:st.map(s=>s.cantidad),backgroundColor:st.map((_,i)=>palette.mixed[i%palette.mixed.length]+'dd'),borderColor:'#161e2e',borderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,cutout:'50%',plugins:{legend:{position:'bottom',labels:{padding:10,usePointStyle:true,font:{size:10}}}}}})}

  const sf=D.suplementos.por_fuente;
  if(sf.length){new Chart($('#chart-sup-fuente'),{type:'doughnut',data:{labels:sf.map(s=>s.fuente),datasets:[{data:sf.map(s=>s.cantidad),backgroundColor:[palette.blue[0]+'dd',palette.red[0]+'dd',palette.purple[0]+'dd',palette.amber[0]+'dd'],borderColor:'#161e2e',borderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,cutout:'50%',plugins:{legend:{position:'bottom',labels:{padding:10,usePointStyle:true,font:{size:10}}}}}})}

  const tc=D.suplementos.top_clientes,mxC=tc.length?tc[0].cantidad:1,rc=$('#rank-clientes-sup');
  tc.forEach((c,i)=>{const p=(c.cantidad/mxC*100).toFixed(0);rc.innerHTML+=`<li class="rank-item"><span class="rank-pos ${rankClass(i)}">${i+1}</span><span class="rank-name">${c.cliente}</span><span class="rank-bar-wrap"><span class="rank-bar" style="width:${p}%;background:${palette.purple[Math.min(i,4)]}"></span></span><span class="rank-val" style="color:${palette.purple[0]}">${c.cantidad}</span></li>`});
  if(!tc.length)rc.innerHTML='<li style="color:var(--txt3);padding:20px;text-align:center">Sin datos</li>';

  const ts=$('#tbl-suplementos tbody');
  D.suplementos.detalle.forEach(s=>{ts.innerHTML+=`<tr><td>${s.fecha}</td><td>${s.cliente}</td><td>${s.numeros}</td><td>${s.tecnico}</td><td><span class="badge ${badgeFor(s.tipo_error)}">${s.tipo_error}</span></td><td><span class="badge ${badgeFor(s.fuente)}">${s.fuente}</span></td><td><span class="badge ${badgeFor(s.estado)}">${s.estado||'-'}</span></td></tr>`});
  if(!D.suplementos.detalle.length)ts.innerHTML='<tr><td colspan="7" style="text-align:center;color:var(--txt3)">Sin suplementos</td></tr>';
}
</script>
</body>
</html>